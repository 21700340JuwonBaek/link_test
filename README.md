 # 한동매칭팀 방학 프로젝트 시작(2020/12/22~)  
 
 ## 12/22 ~ 28   

 준비기간  
 
 다트 언어 학습 동영상 : <https://www.youtube.com/watch?v=jrp_X8sa5aM&list=PLoJdZ7VvEiRMjoNiIBOEjFtlraB-JB02O>   
 플러터를 이용한 UI : <https://www.youtube.com/watch?v=AdYRASHRKwE&list=PLQt_pzi-LLfpcRFhWMywTePfZ2aPapvyl>      
 파이어베이스 실습 : <https://codelabs.developers.google.com/codelabs/flutter-firebase#0>    
 해당 동영상들, 사이트를 보며 다트와 플러터에 대한 기초를 다지는 시간을 가졌다.
 
 ## 12/29
 
 프런트, 백엔드로 명확하게 구분해서 작업을 할당하기가 쉽지 않아서    
 김신 : 채팅   
 이은지 : 마이페이지   
 백종현 : 게시글 목록 페이지   
 백주원 : 로그인/회원가입 기능    
 이렇게 역할 분배 했다.   
 
 ### 백주원   
 플러터 로그인 페이지 예제 : <https://github.com/FirebaseExtended/flutterfire/tree/master/packages/firebase_auth/firebase_auth/example/lib>   
   
위의 사이트에서 예제를 발견해서 코드를 분석하고 활용을 하는 방안으로 가기로 결정함.    

## 12/30

이전까지 각자 개개인의 UI만을 내세워서 진행을 하다보니 일이 진척이 되질 않아 합의된 UI를 도출해냈음    

[매칭앱 UI](https://github.com/21700340JuwonBaek/link_test/blob/master/%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%20UI/%EC%8A%A4%ED%86%A0%EB%A6%AC%EB%B3%B4%EB%93%9C.pdf)

### 백주원


플러터 폼 : <https://www.youtube.com/watch?v=i2SQdh2nreE>   

다음 사이트를 보면서 form을 입력받는 방법에 대해서 학습 후에 코드를 작성하였음...!    
다만 폼을 입력했을 때에 인증메일을 보내는 것 까지는 성공했으나 해당 계정에 대해서 인증이 됐는지 확인하지는 못함.   


## 12/31  

### 백주원   

신이가 채팅방에서 너무 헤매는 것 같아서 내가 작성한 코드를 인계했다. 그리고 채팅방을 맡기로 결정됨.   
플러터 채팅방 참고 사이트 : <https://www.youtube.com/watch?v=d-Bfvwu1zV8&t=5399s>     
해당 동영상을 보고 먼저 채팅앱의 UI를 구현해보는 시간을 가졌다. 


## 2021/1/1

### 백주원   
12/31에 발견한 사이트를 보면서 사진전송 기능을 어떻게 구현하는지 알 수 있었다.   


## 1/2

### 백주원
혼자서 채팅방을 무에서 유로 만드는 것이 힘에 부치다는 생각이 들어서 
[채팅 오픈소스](https://medium.com/flutter-community/building-a-chat-app-with-flutter-and-firebase-from-scratch-9eaa7f41782e) 에서 조금씩 수정해가는 방향을로 틀었다.    

## 1/3

### 백주원 
이전에 오준석의 생존코딩이 조금 도움이 되었던 것을 알았기에   
[다트언어](https://www.youtube.com/watch?v=J_cQyPGyHRI&t=15s)   
[플러터 초급](https://www.youtube.com/watch?v=lRbZsBvG9Ig&list=PLxTmPHxRH3VUueVvEnrP8qxHAP5x9XAPv)   
[플러터 중급](https://www.youtube.com/watch?v=ei8TX-uqP6E&list=PLxTmPHxRH3VWLY-eyQuV1C_IbIQlCXEhe)   
동영상을 시청하며 부족한 부분을 보충해나가기 시작했다.   



## 1/4

### 백주원

오준석의 생존코딩을 보다가 인스타그램 클론 코딩부분에서 유료로 전환되어서 자료를 검색하던 중  
[넷플릭스 클론코딩](https://www.youtube.com/watch?v=wFnXxwlGk4s&list=PL3ilpnPyonYfl82dvBq5fiDD-d4PkRte3&index=4) 을 발견했다.    
시간이 늦어서 다 하지는 못했지만 어느정도 파이어베이스와 플러터를 연동하는 법에 대해서 익힐 수 있었던 듯 하다.   

## 1/5   

### 백주원

[넷플릭스 클론코딩](https://www.youtube.com/watch?v=wFnXxwlGk4s&list=PL3ilpnPyonYfl82dvBq5fiDD-d4PkRte3&index=4)을 시청하고 실습까지 마쳤다.    
또한 [플러터x파이어베이스 연동 tutorial 동영상](https://www.youtube.com/watch?v=zaiE08EWrO0)을 발견해서 나중에 필요할 때에 참조하면 좋겠다 싶어서 남겨본다.    
어느정도 파이어베이스와 연동하는 법을 알았으니, [채팅 오픈소스](https://medium.com/flutter-community/building-a-chat-app-with-flutter-and-firebase-from-scratch-9eaa7f41782e)를 필요한 대로 수정을 할 수 있겠다는 생각이 든다. 



## 1/6 

### 백주원

 [채팅 오픈소스](https://medium.com/flutter-community/building-a-chat-app-with-flutter-and-firebase-from-scratch-9eaa7f41782e)의 코드를 분석하면서 1대1 채팅 기능만 가능하다는 것을 알게 되었다.    
따라서 해당 오픈소스로는 수정을 거치면서 원하는 작품을 완성할 수 없겠다는 생각을 했고 다른 오픈소스를 찾아보기로 했다.   
 
 
## 1/7

### 백주원

[멀티채팅 오픈소스](https://dev.to/ahmedgulabkhan/groupchatapp-a-group-chatting-app-using-flutter-2gif)를 발견했다.   
바로 코드를 받은 다음 분석을 시도해봤는데 쉽지 않았다.   
우선, 팀에서 사용하고 있는 Library의 Dependency가 해당 버전과 맞지 않아서 수정하는 작업을 먼저 진행해주었다.    

## 1/8

### 백주원
채팅앱의 UI를 대대적으로 변경시켜주는 작업을 했다.    
먼저 우리 앱이 사용하는 색상이 파스텔톤의 핑크색인데, 그것에 맞게 메시지 타일, 앱바 등등의 색상을 변경해주는 작업을 했다.    
또한 채팅방의 메시지를 표시할 때에 메시지 전송시각까지 표시하도록 만들었다.(기존에는 String형으로 메시지를 받아왔으나, timeStamp형으로 field를 변경함)   
마지막으로 신이와 같이 코드를 연동하여 로그인--> 채팅방 메인 페이지 로 이동하는 것이 성공했다.     

남아있는 작업으로는    
- 채팅방 메뉴버튼 만들기   
- 채팅방 사진전송기능 넣기   
- 채팅방에서 나가기 기능 만들기   
- 메시지타일에는 시, 분. 날짜 바뀔때마다 날짜 표시해주기.     

가 있다. 


## 1/9

### 백주원
종현이 형의 코드와 내 코드를 합치는 데에 성공했다.    
Grouptile에 해당 채팅방에서 가장 최근에 보낸 메시지를 표시해주고 싶어서 아래의 코드를 작성해보았다.    
<pre><code>
   void getRecentMsg() async {
     await FirebaseFirestore.instance
         .collection('groups')
        .doc(groupId)
        .get()
       .then((DocumentSnapshot documentSnapshot) {
       if (documentSnapshot.exists) {
         recentMsg = documentSnapshot.get('recentMessage');
         print(recentMsg);
       }
     });
   }
</code></pre>   

print는 정상적으로 최근 메시지를 출력하지만, recentMsg 변수를 출력해보면 null이 떠서 여기에서 막혔던 것 같다.    

## 1/11

### 백주원
은지, 신, 종현이형의 코드를 모두 합치는 작업을 완료했다.     


## 1/12

### 백주원   

채팅방에 들어갔을 때/ 혹은 메시지를 전송했을 때에 맨 아래쪽으로 스크롤 되지 않았던 문제가 있었다.    
<pre><code>
Timer(
            Duration(milliseconds: 100),
                () => scrollController
                .jumpTo(scrollController.position.maxScrollExtent));
</code></pre>     

위의 코드를 작성해서 채팅방에 들어가거나 메시지를 전송하면 채팅방 가장 아래쪽으로 Scroll되게끔 만들어주었다.    
Duration 속성을 넣어주지 않으면 에러가 뜨는데, 아마 데이터를 받아오는 시간과 관련있지 않을까 싶었다.    



## 1/13 시연회


## 1/14 

### 백주원  
채팅방에서 나가기 기능, 사진 업로드 기능을 완성시켰음.    
Drawer메뉴에서 Raised Button을 넣어주고, 그것을 클릭했을 때에 Toggle 메소드를 실행시키게끔 해주었다. 

**고려해야하는 사항**
-채팅방에서 나갈 때 남은 인원이 0명인 경우, 채팅방의 메시지기록과 Storage에 있는 사진들을 다 지워야 한다.   
-최근메시지 Grouptile에 표시해줘야한다.   
-채팅방에 있는 사람들의 목록을 채팅방의 메뉴에 출력해야 한다.    
-날짜를 Message tile에 표시하는 것이 아니라 채팅방 중간중간에 날짜가 바뀔때마다 표시해주기   
-누가 들어왔으면 ~가 들어왔습니다. 누가 나갔으면 ~가 나갔습니다 표시해주기. 

## 1/15

### 백주원

최근 메시지를 어떻게 표시해주어야 하나 고민하던 중, Stream Builder을 하나 더 써서 Grouptile에 매게변수로 넘겨주는 것이 어떤지 생각해보았고,    
그 대로 코드를 제작해서 실행해 봤다. 성공했다. 그것을 통해서 최근 메시지 시간, 최근 메시지 내용이 Group Tile에 출력이 되었다.    
다만 최근 메시지의 내용이 길 때에는 Overflow가 발생하는데, 이것을 해결할 필요가 있다.    

## 1/19

### 백주원

- 채팅방 멤버 목록을 Drawer에 표시하는 것 까지 완료했다.(StreamBuilder을 이용해서 데이터 전송)    
- 이전에는 사진을 전송할 때에 Storage에 그냥 전송했는데, 사진을 삭제할 때에는 Storage에서 분류를 해놓는 것이 필요하다고 판단해서    
채팅방 GroupId의 폴더 내에 전송된 사진들을 보관하기로 했다.    
- 채팅방에서 인원이 0명일 경우 채팅방이 데이터베이스에서 삭제되는 코드까지 추가를 했다.    
- 마지막으로 채팅방 삭제시에 Storage에 저장된 데이터까지 삭제했다.   ([참조사이트](https://stackoverflow.com/questions/37749647/firebasestorage-how-to-delete-directory/37757909
))

## 1/20

### 백주원

채팅방에서 나갔을 때에 System type형 메시지를 전달하는 방법으로 '~가 나갔습니다'를 전송했다.   
메시지 타입별로 UI를 다르게 해서 출력이 가능해서 좋았던 것 같다.   

문제는 하루가 지날 때에 날짜를 채팅방에다 표시해주는 것인데, 위젯으로 최근 메시지의 시간을 전달해주다 보니 에러사항이 있다.   
밤 11시쯤 문득 생각나서 코딩을 했는데, 그냥 chat_room에서 최근 메시지 시간에 대한 데이터를 받아오는 것이 방법이었다.   
메시지를 전송할 때에 해당 채팅방의 document에서 recentMessageTime 필드를 가져오고, 메시지를 보내는 시점의 시간을 비교해서    
Day의 차이가 있다면 DateChecker형 메시지를 전송하는 로직을 짰다.    

GroupTile에서 시간을 위쪽, 최근 메시지를 아래쪽으로 분리하는 것이 좋다고 판단해서 시간을 받는 StreamBuilder을 또 생성했다.(흠....)   

RecentMessage의 Overflow문제를 해결했다. [참조사이트](https://stackoverflow.com/questions/44579918/flutter-wrap-text-on-overflow-like-insert-ellipsis-or-fade)    

## 1/21

### 백주원

- StreamBuilder에서 멤버가 Admin이라면 (방장)이라는 텍스트를 같이 보내주게끔 바꾸어줬다.
- Drawer의 UI를 좀 바꿔주었다. [참조사이트](https://stackoverflow.com/questions/47951907/change-flutter-drawer-background-color/47952148)   
- 멤버의 목록을 divide해서 나타내는게 좋을까 생각해서 찾아본 사이트...[참조사이트](https://stackoverflow.com/questions/50687633/flutter-divider-how-could-i-add-divider-between-each-line-in-my-code)   
-마지막으로 멤버의 수가 많아지면 ListView가 핸드폰 화면 밖으로 나가버려 Overflow가 발생했는데, Extend태그를 써서 해결했다.




